{"version":3,"sources":["../src/components/context-menu/contextMenu.tsx"],"names":[],"mappings":"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","file":"components/context-menu/contextMenu.js","sourcesContent":["/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n * Licensed under the BSD-3 License as modified (the “License”); you may obtain a copy\n * of the license at https://github.com/palantir/blueprint/blob/master/LICENSE\n * and https://github.com/palantir/blueprint/blob/master/PATENTS\n */\n\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\n\nimport { AbstractComponent } from \"../../common/abstractComponent\";\nimport * as Classes from \"../../common/classes\";\nimport { Position } from \"../../common/position\";\nimport { safeInvoke } from \"../../common/utils\";\nimport { Popover } from \"../popover/popover\";\n\nexport interface IOffset {\n    left: number;\n    top: number;\n}\n\ninterface IContextMenuState {\n    isOpen?: boolean;\n    menu?: JSX.Element;\n    offset?: IOffset;\n    onClose?: () => void;\n}\n\nconst CONSTRAINTS = [ { attachment: \"together\", pin: true, to: \"window\" } ];\nconst TRANSITION_DURATION = 100;\n\nclass ContextMenu extends AbstractComponent<{}, IContextMenuState> {\n    public state: IContextMenuState = {\n        isOpen: false,\n    };\n\n    public render() {\n        // prevent right-clicking in a context menu\n        const content = <div onContextMenu={this.cancelContextMenu}>{this.state.menu}</div>;\n        return (\n            <Popover\n                backdropProps={{ onContextMenu: this.handleBackdropContextMenu }}\n                constraints={CONSTRAINTS}\n                content={content}\n                enforceFocus={false}\n                isModal={true}\n                isOpen={this.state.isOpen}\n                onInteraction={this.handlePopoverInteraction}\n                position={Position.RIGHT_TOP}\n                popoverClassName={Classes.MINIMAL}\n                useSmartArrowPositioning={false}\n                transitionDuration={TRANSITION_DURATION}\n            >\n                <div className={Classes.CONTEXT_MENU_POPOVER_TARGET} style={this.state.offset} />\n            </Popover>\n        );\n    }\n\n    public show(menu: JSX.Element, offset: IOffset, onClose?: () => void) {\n        this.setState({ isOpen: true, menu, offset, onClose });\n    }\n\n    public hide() {\n        const { onClose } = this.state;\n        this.setState({ isOpen: false, onClose: null });\n        safeInvoke(onClose);\n    }\n\n    private cancelContextMenu = (e: React.SyntheticEvent<HTMLDivElement>) => e.preventDefault();\n\n    private handleBackdropContextMenu = (e: React.MouseEvent<HTMLDivElement>) => {\n        // HACKHACK: React function to remove from the event pool (not sure why it's not in typings #66)\n        (e as any).persist();\n        e.preventDefault();\n        // wait for backdrop to disappear so we can find the \"real\" element at event coordinates.\n        // timeout duration is equivalent to transition duration so we know it's animated out.\n        this.setTimeout(() => {\n            // retrigger context menu event at the element beneath the backdrop.\n            // if it has a `contextmenu` event handler then it'll be invoked.\n            // if it doesn't, no native menu will show (at least on OSX) :(\n            const newTarget = document.elementFromPoint(e.clientX, e.clientY);\n            newTarget.dispatchEvent(new MouseEvent(\"contextmenu\", e));\n        }, TRANSITION_DURATION);\n    }\n\n    private handlePopoverInteraction = (nextOpenState: boolean) => {\n        if (!nextOpenState) {\n            this.hide();\n        }\n    }\n}\n\nlet contextMenu: ContextMenu;\n\n/**\n * Show the given menu element at the given offset from the top-left corner of the viewport.\n * The menu will appear below-right of this point and will flip to below-left if there is not enough\n * room onscreen. The optional callback will be invoked when this menu closes.\n */\nexport function show(menu: JSX.Element, offset: IOffset, onClose?: () => void) {\n    if (contextMenu == null) {\n        const contextMenuElement = document.createElement(\"div\");\n        contextMenuElement.classList.add(Classes.CONTEXT_MENU);\n        document.body.appendChild(contextMenuElement);\n        contextMenu = ReactDOM.render(<ContextMenu />, contextMenuElement) as ContextMenu;\n    }\n\n    contextMenu.show(menu, offset, onClose);\n}\n\n/** Hide the open context menu. */\nexport function hide() {\n    if (contextMenu != null) {\n        contextMenu.hide();\n    }\n}\n\n/** Return whether a context menu is currently open. */\nexport function isOpen() {\n    return contextMenu != null && contextMenu.state.isOpen;\n}\n"]}